<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CSC Adherence Timer</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Icons + audio -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js" defer></script>
  <script src="sfx.js" defer></script>
</head>
<body class="dark">
  <header>
    <img src="logo.png" alt="CSC logo" />
    <div class="title-wrap">
      <h1>CSC Adherence Timer</h1>
      <div id="currentDate" class="subtle-date" aria-label="Current date">â€”</div>
    </div>
    <div class="controls ml-auto" role="group" aria-label="App controls">
      <label for="profileSwitcher">Profile</label>
      <select id="profileSwitcher" title="Select a profile">
        <option value="default">default</option>
      </select>
      <button id="toggleSettings" type="button" title="Show or hide settings">Settings</button>
      <button id="installApp" type="button" title="Install this app" disabled>Install</button>
    </div>
  </header>

  <main class="container">
    <div class="controls top-actions" role="group" aria-label="Top actions">
      <button id="managerEscalation" class="escalation" type="button" title="Mute alerts except Break/Meal">
        <i class="fa-solid fa-user-tie"></i> Manager Escalation: <span class="state">OFF</span>
      </button>
      <span class="hint">When ON, only Break and Meal sounds play.</span>
    </div>

    <section class="time-container state-upcoming" aria-live="polite">
      <div class="clock" id="currentTime" aria-label="Current time">00:00:00</div>
      <div class="time-metadata">
        <div class="countdown" id="countdown">ðŸ•’ Countdown to next event: --</div>
        <div class="expected-status" id="expectedStatus">Current Expected Status: --</div>
      </div>
    </section>

    <div class="timeline" aria-label="Day progress">
      <div id="timelineTicks" class="timeline-ticks">
        <span data-p="0">00:00</span>
        <span data-p="25">06:00</span>
        <span data-p="50">12:00</span>
        <span data-p="75">18:00</span>
        <span data-p="100">24:00</span>
      </div>
      <div id="timelineEvents" class="timeline-events" aria-hidden="true"></div>
      <div id="timelineProgress" class="timeline-progress" aria-hidden="true"></div>
    </div>

    <div id="queue-group" class="status-buttons" role="group" aria-label="Acknowledge current status">
      <button id="onQueue"   type="button" draggable="true" title="On Queue"><i class="fa-solid fa-headset"></i> On Queue</button>
      <button id="available" type="button" draggable="true" title="Available"><i class="fa-solid fa-check-circle"></i> Available</button>
      <button id="c2c"       type="button" draggable="true" title="Online training class"><i class="fa-solid fa-chalkboard-user"></i> C2C</button>
      <button id="break"     type="button" draggable="true" title="Break"><i class="fa-solid fa-mug-saucer"></i> Break</button>
      <button id="meal"      type="button" draggable="true" title="Meal"><i class="fa-solid fa-utensils"></i> Meal</button>
      <button id="meeting"   type="button" draggable="true" title="Meeting"><i class="fa-solid fa-users"></i> Meeting</button>
      <button id="busy"      type="button" draggable="true" title="Busy"><i class="fa-solid fa-ban"></i> Busy</button>
      <button id="shiftEnd"  type="button" draggable="true" title="Shift End"><i class="fa-solid fa-door-open"></i> Shift End</button>
    </div>

    <div class="grid mt-12">
      <section aria-labelledby="schedule-heading">
        <h2 id="schedule-heading" class="sr-only">Schedule</h2>
        <!-- Inline editor: appears above the schedule list when editing an adâ€‘hoc event -->
        <div id="inlineEditor" class="inline-editor" hidden>
          <div class="section-title">Edit selected event</div>
          <div class="controls">
            <label for="editType">Type</label>
            <select id="editType">
              <option>On Queue</option><option>Available</option><option>C2C</option>
              <option>Break</option><option>Meal</option><option>Meeting</option>
              <option>Busy</option><option>Shift End</option>
            </select>
            <label for="editTime">Time</label>
            <input id="editTime" type="time" step="60" />
            <button id="saveChanges" class="success" type="button">Save</button>
            <button id="cancelChanges" type="button">Cancel</button>
          </div>
        </div>

        <div id="scheduleCards" aria-live="polite"></div>
      </section>

      <aside aria-labelledby="settings-heading">
        <h2 id="settings-heading" class="sr-only">Settings</h2>

        <div id="settingsPanel">
  <div class="setting-row version-row"><small>Version: <span id="app-version"></span></small></div>
          <div class="section-title">Profiles</div>
        <div class="form-grid">
            <div class="form-row">
              <label class="label">Profile</label>
              <div class="control"><span id="currentProfileLabel">default</span></div>
            </div>
            <div class="form-row">
              <label class="label" for="addProfile">Add Profile</label>
              <div class="control"><button id="addProfile" type="button" title="Create a new profile">Add</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="deleteProfile">Delete Profile</label>
              <div class="control"><button id="deleteProfile" type="button" class="danger" title="Delete current profile">Delete</button></div>
            </div>
          </div>

          <div class="section-title">General</div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label" for="timeFormat">Time format</label>
              <div class="control"><select id="timeFormat"><option value="12">12h</option><option value="24">24h</option></select></div>
            </div>
            <div class="form-row">
              <label class="label" for="timeZone">Time zone</label>
              <div class="control"><select id="timeZone" title="Time zone"></select></div>
            </div>
            <div class="form-row">
              <label class="label" for="enableNotifications">Enable notifications</label>
              <div class="control"><input id="enableNotifications" type="checkbox" title="Enable desktop notifications for reminders and alerts" /></div>
            </div>

            <!-- Theme selection: allow switching between dark and light modes -->
            <div class="form-row">
              <label class="label" for="themeSelect">Theme</label>
              <div class="control"><select id="themeSelect" title="Select a color theme">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
              </select></div>
            </div>
          </div>

          <div class="section-title">Event Timing</div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label" for="leadSlider">Lead warning (min)</label>
              <div class="control slider"><input id="leadSlider" type="range" min="1" max="30" value="5" /> <span id="leadVal">5</span></div>
            </div>
            <div class="form-row">
              <label class="label" for="over1Slider">First overdue (min)</label>
              <div class="control slider"><input id="over1Slider" type="range" min="1" max="30" value="2" /> <span id="over1Val">2</span></div>
            </div>
            <div class="form-row">
              <label class="label" for="over2Slider">Second overdue (min)</label>
              <div class="control slider"><input id="over2Slider" type="range" min="1" max="30" value="5" /> <span id="over2Val">5</span></div>
            </div>
          </div>

          <div class="section-title">Sounds</div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label" for="enableSounds">Enable alert sounds</label>
              <div class="control"><input id="enableSounds" type="checkbox" checked /></div>
            </div>
            <div class="form-row">
              <label class="label" for="enableClicks">Enable click sounds</label>
              <div class="control"><input id="enableClicks" type="checkbox" checked /></div>
            </div>
            <div class="form-row">
              <label class="label" for="volumeSlider">Volume</label>
              <div class="control slider"><input id="volumeSlider" type="range" min="0" max="100" value="50" /> <span id="volumeVal">50</span></div>
            </div>
            <div class="form-row">
              <label class="label" for="clickPattern">Click sound</label>
              <div class="control"><select id="clickPattern"></select> <button id="previewClick" type="button" class="preview" title="Preview click sound">â–¶ï¸Ž</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="leadPattern">Lead warning</label>
              <div class="control"><select id="leadPattern"></select> <button id="previewLead" type="button" class="preview" title="Preview lead warning sound">â–¶ï¸Ž</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="atPattern">At event</label>
              <div class="control"><select id="atPattern"></select> <button id="previewAt" type="button" class="preview" title="Preview at-event sound">â–¶ï¸Ž</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="over1Pattern">After event (first)</label>
              <div class="control"><select id="over1Pattern"></select> <button id="previewOver1" type="button" class="preview" title="Preview first overdue sound">â–¶ï¸Ž</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="over2Pattern">After event (second)</label>
              <div class="control"><select id="over2Pattern"></select> <button id="previewOver2" type="button" class="preview" title="Preview second overdue sound">â–¶ï¸Ž</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="uploadSoundBtn">Upload .mp3</label>
              <div class="control">
                <!-- Hidden file input for custom audio uploads.  Marked as
                     aria-hidden so it doesnâ€™t require an explicit label.  The
                     Upload button below triggers this input. -->
                <input id="uploadSound" type="file" accept="audio/mp3" hidden aria-hidden="true" title="Select an MP3 file" />
                <button id="uploadSoundBtn" type="button" title="Upload a custom .mp3">Uploadâ€¦</button>
              </div>
            </div>
          </div>

          <div class="section-title">Schedules</div>
          <div class="form-grid">
            <!-- Combined import for schedules or backups -->
            <div class="form-row">
              <label class="label" for="importFile">Import JSON/Backup</label>
              <div class="control">
                <input type="file" id="importFile" accept="application/json" />
                <button id="importBtn" type="button" title="Import selected schedule file or full backup">Import</button>
              </div>
            </div>
            <div class="form-row">
              <label class="label">Export</label>
              <div class="control">
                <button id="exportSchedule" type="button" title="Export events for the selected day (or ad-hoc list if no day is selected)">Export (selected)</button>
                <button id="exportAll" type="button" title="Export the entire schedule (ad-hoc and weekly planner) for the current profile">Export All</button>
              </div>
            </div>
            <div class="form-row">
              <label class="label" for="resetApp">Reset all data</label>
              <div class="control"><button id="resetApp" class="danger" type="button" title="Clear all data">Reset</button></div>
            </div>
            <div class="form-row">
              <label class="label" for="backupBtn">Backup All Data</label>
              <div class="control"><button id="backupBtn" type="button" title="Download a backup of all profiles, schedules, settings and sounds">Backup</button></div>
            </div>
          </div>

          <div class="section-title">Help</div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label" for="helpBtn">Help &amp; Tips</label>
              <div class="control"><button id="helpBtn" type="button" title="Show help and tips">Help</button></div>
            </div>
          </div>
        </div>

        <div class="section-title">Quick Add</div>
        <div class="controls">
          <label for="eventType">Event</label>
          <select id="eventType" title="Event type">
            <option>On Queue</option><option>Available</option><option>C2C</option>
            <option>Break</option><option>Meal</option><option>Meeting</option>
            <option>Busy</option><option>Shift End</option>
          </select>
          <label for="eventTime">Time</label>
          <input id="eventTime" type="time" step="60" title="Event time" />
          <button id="addEvent" class="primary" type="button" title="Add to list">Add</button>
        </div>

        <div class="planner-wrap">
          <table id="weekTable" aria-label="Weekly planner">
            <thead>
              <tr>
                <th data-day-h="Sun">Sun <button class="ghost add" type="button" data-day="Sun" title="Add">ï¼‹</button></th>
                <th data-day-h="Mon">Mon <button class="ghost add" type="button" data-day="Mon" title="Add">ï¼‹</button></th>
                <th data-day-h="Tue">Tue <button class="ghost add" type="button" data-day="Tue" title="Add">ï¼‹</button></th>
                <th data-day-h="Wed">Wed <button class="ghost add" type="button" data-day="Wed" title="Add">ï¼‹</button></th>
                <th data-day-h="Thu">Thu <button class="ghost add" type="button" data-day="Thu" title="Add">ï¼‹</button></th>
                <th data-day-h="Fri">Fri <button class="ghost add" type="button" data-day="Fri" title="Add">ï¼‹</button></th>
                <th data-day-h="Sat">Sat <button class="ghost add" type="button" data-day="Sat" title="Add">ï¼‹</button></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-day="Sun"></td><td data-day="Mon"></td><td data-day="Tue"></td>
                <td data-day="Wed"></td><td data-day="Thu"></td><td data-day="Fri"></td><td data-day="Sat"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </aside>
    </div>
  </main>

  <!-- Planner popup removed; editing is handled by a single modal -->

  <!-- Help / tips modal -->
  <div id="helpPopup" class="popup" hidden>
    <div class="popup-title">Help &amp; Guide</div>
    <div class="popup-content">
      <p><strong>Color codes:</strong> Green â€“ upcoming; Yellow â€“ approaching; Red â€“ overdue. These colors apply to the clock and the expected status.</p>
      <p><strong>Status buttons:</strong> Click the button that matches your actual status. A green outline appears when you match the expected status.</p>
      <p><strong>Manager Escalation:</strong> When ON, only Break and Meal alerts play.</p>
      <p>You can adjust lead/overdue timers, sounds, themes, and more in Settings. Export a single day, export all or download a backup from the Schedules section.</p>
      <p><strong>Keyboard shortcuts:</strong> Use <kbd>Alt</kbd> + <kbd>1</kbd>â€¦<kbd>8</kbd> to acknowledge the corresponding status button, in the order you arrange them. Drag and drop the buttons to reorder.</p>
      <p><strong>Audio notice:</strong> Modern browsers require you to interact with the page before they will play any sound.  Click anywhere on the app (for example, one of the status buttons) to "unlock" audio.  If you refresh or reopen the app, you may need to do this again before alerts and clicks will be audible.</p>
    </div>
    <div class="popup-actions">
      <button id="helpClose" type="button" class="primary">Close</button>
    </div>
  </div>

  <!-- Onboarding modal: shows once on first visit to explain basic usage -->
  <div id="onboardingPopup" class="popup" hidden>
    <div class="popup-title">Welcome to CSC Adherence Timer</div>
    <div class="popup-content">
      <p>This web app helps you stay on top of your schedule. Your daily events appear as cards and on the timeline above.</p>
      <p>When a coloured event becomes active, the clock and expected status will turn yellow or red. Click the matching status button to acknowledge it.</p>
      <p>You can customize lead/overdue warnings, sounds, themes and more in Settings. Use the planner below to set up weekly schedules. Import/export or back up your data from the Settings panel.</p>
    </div>
    <div class="popup-actions">
      <button id="onboardingOk" type="button" class="primary">Got it</button>
    </div>
  </div>

  <!-- Unified event editor modal -->
  <div id="editModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-title">Edit Event</div>
      <label>
        Day
        <span id="editDayLabel"></span>
      </label>
      <label>
        Type
        <select id="editModalType">
          <option>On Queue</option><option>Available</option><option>C2C</option>
          <option>Break</option><option>Meal</option><option>Meeting</option>
          <option>Busy</option><option>Shift End</option>
        </select>
      </label>
      <label>
        Time
        <input id="editModalTime" type="time" step="60" />
      </label>
      <div class="modal-actions">
        <button id="editModalSave" class="primary" type="button">Save</button>
        <button id="editModalCancel" type="button">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Toast container for notifications -->
  <div id="toastContainer" class="toast-container"></div>

  <script src="app.js" defer></script>
</body>
</html>

